####################
# Jenkins Deployment 
####################

docker network create jenkins --attachable

docker volume create jenkins

docker run --name jenkins --network jenkins -w /var/jenkins_home -id -v jenkins:/var/jenkins_home -p 80:8080 --restart unless-stopped jenkins/jenkins:lts

docker run --name jenkins --network jenkins -w /var/jenkins_home -id -v jenkins:/var/jenkins_home -p 80:8080 -v $(which docker):/usr/bin/docker -v /var/run/docker.sock:/var/run/docker.sock --restart unless-stopped jenkins/jenkins:lts


##################
# BackUps Jenkins
##################
docker run --rm --volumes-from jenkins -v $(pwd):/backup busybox tar cvfz /backup/backup.tar /var/jenkins_home

##################
# Restore Jenkins 
##################


docker exec -u root -it jenkins bash -c "rm -rf *"

docker exec -u root -it jenkins ls 

docker exec -u root -it jenkins pwd

docker cp $PWD/backup.tar jenkins:/var/jenkins_home

docker exec -u root -it jenkins ls 

docker exec -u root -it jenkins tar -xzvf backup.tar

docker exec -u root -it jenkins ls 

docker exec -u root -it jenkins rm -f backup.tar

docker exec -u root -it jenkins ls var/jenkins_home

docker exec -u root -it jenkins bash -c "cd var/jenkins_home && mv * /var/jenkins_home"

docker exec -u root -it jenkins bash -c "rm -rf var"

docker exec -u root -it jenkins ls 

docker restart jenkins

#################
# Single Command
#################

docker exec -u root -it jenkins bash -c "rm -rf *" && docker cp $PWD/backup.tar jenkins:/var/jenkins_home && docker exec -u root -it jenkins bash -c "tar -xzvf backup.tar" && docker exec -u root -it jenkins bash -c "cd var/jenkins_home && mv * /var/jenkins_home" && docker exec -u root -it jenkins bash -c "rm -rf var" && docker restart jenkins


# docker run --rm --volumes-from CONTAINER -v $(pwd):/backup busybox bash -c "cd CONTAINERPATH && tar xvf /backup/backup.tar --strip 1"
